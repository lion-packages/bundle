<?php

/**
 * ------------------------------------------------------------------------------
 * Register The Auto Loader
 * ------------------------------------------------------------------------------
 * Composer provides a convenient, automatically generated class loader for
 * this application
 * ------------------------------------------------------------------------------
 **/

require_once("vendor/autoload.php");

/**
 * ------------------------------------------------------------------------------
 * Register environment variable loader automatically
 * ------------------------------------------------------------------------------
 * .dotenv provides an easy way to access environment variables with $_ENV
 * ------------------------------------------------------------------------------
 **/

(Dotenv\Dotenv::createImmutable(__DIR__))->load();

/**
 * ------------------------------------------------------------------------------
 * initialization of predefined constants and functions
 * ------------------------------------------------------------------------------
 **/

include_once(__DIR__ . "\\storage\\framework\\helpers.php");

/**
 * ------------------------------------------------------------------------------
 * Import route for RSA
 * ------------------------------------------------------------------------------
 * Load default route for RSA
 * ------------------------------------------------------------------------------
 **/

if (env->RSA_URL_PATH != '') {
    LionSecurity\RSA::$url_path = path(env->RSA_URL_PATH);
}

/**
 * ------------------------------------------------------------------------------
 * Start database service
 * ------------------------------------------------------------------------------
 * Upload data to establish a connection
 * ------------------------------------------------------------------------------
 **/

LionSQL\Drivers\MySQLDriver::init([
    'type' => env->DB_TYPE,
    'host' => env->DB_HOST,
    'port' => env->DB_PORT,
    'dbname' => env->DB_NAME,
    'user' => env->DB_USER,
    'password' => env->DB_PASSWORD
]);

/**
 * ------------------------------------------------------------------------------
 * Start email sending service
 * ------------------------------------------------------------------------------
 * enter account access credentials
 * ------------------------------------------------------------------------------
 **/

LionMailer\Mailer::init([
    'debug' => (int) env->MAIL_DEBUG,
    'host' => env->MAIL_HOST,
    'username' => env->MAIL_USERNAME,
    'password' => env->MAIL_PASSWORD,
    'encryption' => env->MAIL_ENCRYPTION,
    'port' => (int) env->MAIL_PORT,
]);

/**
 * ------------------------------------------------------------------------------
 * Console Routes
 * ------------------------------------------------------------------------------
 * This is where you can record your commands for your application
 * ------------------------------------------------------------------------------
 **/

$web_commands = include_once(path('\\routes\\console.php'));

$commands = [
    \App\Console\Framework\ControllerCommand::class,
    \App\Console\Framework\ModelCommand::class,
    \App\Console\Framework\MiddlewareCommand::class,
    \App\Console\Framework\CommandsCommand::class,
    \App\Console\Framework\TestCommand::class,
    \App\Console\Framework\ServerCommand::class,
    \App\Console\Framework\RunTestCommand::class,
    \App\Console\Framework\RulesCommand::class,
    \App\Console\Framework\RSACommand::class,
    \App\Console\Framework\GenerateJWTCommand::class,
    \App\Console\Framework\RouteListCommand::class,
    \App\Console\Framework\CapsuleCommand::class,
    \App\Console\Framework\AllCapsulesCommand::class,
    \App\Console\Framework\FactoryCommand::class,
    \App\Console\Framework\TraitCommand::class,
    \App\Console\Framework\SeedCommand::class,
    ...$web_commands
];

$application = new Symfony\Component\Console\Application('Lion-Framework');

foreach ($commands as $key => $command) {
    $application->add(new $command());
}

$application->run();